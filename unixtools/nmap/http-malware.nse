description = [[
Performs a bogus GET request for the root folder ("/")
Normal http server will reply with an http status 200 or error 
Asporx will replay around 100 byte of binary.
]]

author = "Jérémie Banier"

license = "Same as Nmap--See http://nmap.org/book/man-legal.html"

categories = {"discovery", "safe"}

require "shortport"
require "http"

portrule = shortport.http

action = function(host, port)
        local result, socket, try, catch
        socket = nmap.new_socket()

        catch = function()
                socket:close()
        end

        try = nmap.new_try(catch)
        try(socket:connect(host, port))
        try(socket:send("HTTP 1.1 GET/\n\n"))
        result = try(socket:receive_bytes(100))

        -- Check if first 4 bytes received are HTTP.
        if not string.match(result, "^HTTP") then
                return "Asprox/Kuluoz infected:" .. stdnse.tohex(result)
        end
end